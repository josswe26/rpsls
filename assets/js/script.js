// Wait for the DOM to finish loading before running the code
// Get the button elements and add event listeners to them

document.addEventListener("DOMContentLoaded", function () {

    //Add event listener to game buttons
    let buttons = document.getElementsByClassName("game-btn");

    for (let button of buttons) {
        button.addEventListener("click", function () {
            let userChoice = this.getAttribute("data-type");
            let userIcon = document.getElementById("user-icon");

            runGame(userChoice, userIcon);
        })
    }

    //Add event listener to buttons opening the popups
    let openPopupButtons = document.getElementsByClassName("open-popup-btn");

    for (let button of openPopupButtons) {
        button.addEventListener("click", function () {
            let buttonSelected = this.getAttribute("id");

            openPopup(buttonSelected);
        })
    }

    //Add event listener to close buttons on the popups
    let closePopupButtons = document.getElementsByClassName("close-popup-btn");

    for (let button of closePopupButtons) {
        button.addEventListener("click", function () {
            let buttonSelected = this.getAttribute("id");

            closePopup(buttonSelected);
        })
    }

    //Add event listener to the start game button
    document.getElementById("start-game-btn").addEventListener("click", function () {
        window.location.href = "#game-section";
    })
})

//Game functions

/**
 * Contain the main game functionality, called when the user select their first weapon
 */
function runGame(choice, icon) {

    displayWeapon(choice, icon);
    computerWeapon();

    compareWeapons();
}

/**
 * Display the weapon chosen by the user and generated by the computer 
 */
function displayWeapon(weapon, icon) {
    if (weapon === "rock") {
        icon.setAttribute("class", "fas fa-hand-rock");
        icon.style.color = "#bf834a";
    } else if (weapon === "paper") {
        icon.setAttribute("class", "far fa-hand-paper");
        icon.style.color = "#151311";
    } else if (weapon === "scissors") {
        icon.setAttribute("class", "fas fa-hand-scissors");
        icon.style.color = "#151311";
    } else if (weapon === "lizard") {
        icon.setAttribute("class", "fas fa-hand-lizard");
        icon.style.color = "#789053";
    } else if (weapon === "spock") {
        icon.setAttribute("class", "fas fa-hand-spock");
        icon.style.color = "#344b99";
    } else {
        alert(`Unknown weapon type: ${weapon}`);
        throw `Unknown weapon type: ${weapon}. Aborting!`
    }
}

/**
 * Generate computer weapon and call displayWeapon to pass values
 */
function computerWeapon() {
    let weapons = ["rock", "paper", "scissors", "lizard", "spock"];
    let computerChoice = weapons[Math.floor(Math.random() * weapons.length)];
    let computerIcon = document.getElementById("computer-icon");

    displayWeapon(computerChoice, computerIcon);
}

function compareWeapons() {
    let userWeapon = document.getElementById("user-icon").getAttribute("class").split("-")[2];
    let computerWeapon = document.getElementById("computer-icon").getAttribute("class").split("-")[2];

    //Same weapom selected
    if (userWeapon === computerWeapon) {
        document.getElementById("result").textContent = "It's a draw!";
    } 
    
    //Rock chosen by the user
    else if (userWeapon === "rock" && computerWeapon === "paper") {
        document.getElementById("result").textContent = "Paper covers rock, you lose :("
    } else if (userWeapon === "rock" && computerWeapon === "scissors") {
        document.getElementById("result").textContent = "Rock crushes scissors, you win!"
    } else if (userWeapon === "rock" && computerWeapon === "lizard") {
        document.getElementById("result").textContent = "Rock crushes lizard, you win!"
    } else if (userWeapon === "rock" && computerWeapon === "spock") {
        document.getElementById("result").textContent = "Spock vaporizes rock, you lose :("
    }

    //Paper chosen by the user
    else if (userWeapon === "paper" && computerWeapon === "rock") {
        document.getElementById("result").textContent = "Paper covers rock, you win!"
    } else if (userWeapon === "paper" && computerWeapon === "scissors") {
        document.getElementById("result").textContent = "Scissors cuts paper, you lose :("
    } else if (userWeapon === "paper" && computerWeapon === "lizard") {
        document.getElementById("result").textContent = "Lizard eats paper, you lose :("
    } else if (userWeapon === "paper" && computerWeapon === "spock") {
        document.getElementById("result").textContent = "Paper disproves Spock, you win!"
    }

    //Scissors chosen by the user
    else if (userWeapon === "scissors" && computerWeapon === "rock") {
        document.getElementById("result").textContent = "Rock crushes scissors, you lose :("
    } else if (userWeapon === "scissors" && computerWeapon === "paper") {
        document.getElementById("result").textContent = "Scissors cuts paper, you win!"
    } else if (userWeapon === "scissors" && computerWeapon === "lizard") {
        document.getElementById("result").textContent = "Scissors decapitates lizard, you win!"
    } else if (userWeapon === "scissors" && computerWeapon === "spock") {
        document.getElementById("result").textContent = "Spock smashes scissors, you lose :("
    }

    //Lizard chosen by the user
    else if (userWeapon === "lizard" && computerWeapon === "rock") {
        document.getElementById("result").textContent = "Rock crushes lizard, you lose :("
    } else if (userWeapon === "lizard" && computerWeapon === "paper") {
        document.getElementById("result").textContent = "Lizard eats paper, you win!"
    } else if (userWeapon === "lizard" && computerWeapon === "scissors") {
        document.getElementById("result").textContent = "Scissors decapitates lizard, you lose :("
    } else if (userWeapon === "lizard" && computerWeapon === "spock") {
        document.getElementById("result").textContent = "Lizard poisons Spock, you win!"
    }

    //Spock chosen by the user
    else if (userWeapon === "spock" && computerWeapon === "rock") {
        document.getElementById("result").textContent = "Spock vaporizes rock, you win!"
    } else if (userWeapon === "spock" && computerWeapon === "paper") {
        document.getElementById("result").textContent = "Paper disproves Spock, you lose :("
    } else if (userWeapon === "spock" && computerWeapon === "scissors") {
        document.getElementById("result").textContent = "Spock smashes scissor, you win!"
    } else if (userWeapon === "spock" && computerWeapon === "lizard") {
        document.getElementById("result").textContent = "Lizard poisons Spock, you lose :("
    }
}

function increaseUserScore() {

}

function increaseComputerScore() {

}

function countRounds() {

}

//Popups functions

/**
 * Open the pop up when pressing the respective button
 */
function openPopup(button) {
    if (button === "open-feedback-btn") {
        document.getElementById("feedback-form").style.display = "block";
    } else if (button === "open-rules-btn") {
        document.getElementById("rules").style.display = "block";
    } else {
        alert(`Unknown button: ${button}`);
        throw `Unknown butoon: ${button}. Aborting!`
    }
}

/**
 * Close the pop up if close button is pressed
 */
function closePopup(button) {
    if (button === "close-feedback-btn") {
        document.getElementById("feedback-form").style.display = "none";
    } else if (button === "close-rules-btn") {
        document.getElementById("rules").style.display = "none";
    } else {
        alert(`Unknown button: ${button}`);
        throw `Unknown button: ${button}. Aborting!`
    }
}