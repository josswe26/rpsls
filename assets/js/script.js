// Wait for the DOM to finish loading before running the code
// Get the button elements and add event listeners to them

document.addEventListener("DOMContentLoaded", function () {

    //Add event listener to game buttons
    let buttons = document.getElementsByClassName("game-btn");

    for (let button of buttons) {
        button.addEventListener("click", function () {
            let userChoice = this.getAttribute("data-type");
            let userIcon = document.getElementById("user-icon");

            runGame(userChoice, userIcon);
        })
    }

    //Add event listener to buttons opening the popups
    let openPopupButtons = document.getElementsByClassName("open-popup-btn");

    for (let button of openPopupButtons) {
        button.addEventListener("click", function () {
            let buttonSelected = this.getAttribute("id");

            openPopup(buttonSelected);
        })
    }

    //Add event listener to close buttons on the popups
    let closePopupButtons = document.getElementsByClassName("close-popup-btn");

    for (let button of closePopupButtons) {
        button.addEventListener("click", function () {
            let buttonSelected = this.getAttribute("id");

            closePopup(buttonSelected);
        })
    }

    //Add event listener to the start game button
    document.getElementById("start-game-btn").addEventListener("click", function () {
        window.location.href = "#game-section";
    })
})

//Game functions

/**
 * Contain the main game functionality, called when the user select their first weapon
 */
function runGame(choice, icon) {
    let gameFinished = false;

    displayWeapon(choice, icon);

    computerWeapon();

    compareWeapons();
    gameFinished = countRounds();

    if (gameFinished) {
        clearScore()
    }
}

/**
 * Display the weapon chosen by the user and generated by the computer 
 */
function displayWeapon(weapon, icon) {
    if (weapon === "rock") {
        icon.setAttribute("class", "fas fa-hand-rock");
        icon.style.color = "#bf834a";
    } else if (weapon === "paper") {
        icon.setAttribute("class", "far fa-hand-paper");
        icon.style.color = "#151311";
    } else if (weapon === "scissors") {
        icon.setAttribute("class", "fas fa-hand-scissors");
        icon.style.color = "#151311";
    } else if (weapon === "lizard") {
        icon.setAttribute("class", "fas fa-hand-lizard");
        icon.style.color = "#789053";
    } else if (weapon === "spock") {
        icon.setAttribute("class", "fas fa-hand-spock");
        icon.style.color = "#344b99";
    } else {
        alert(`Unknown weapon type: ${weapon}`);
        throw `Unknown weapon type: ${weapon}. Aborting!`
    }
}

/**
 * Generate computer weapon and call displayWeapon to pass values
 */
function computerWeapon() {
    let weapons = ["rock", "paper", "scissors", "lizard", "spock"];
    let computerChoice = weapons[Math.floor(Math.random() * weapons.length)];
    let computerIcon = document.getElementById("computer-icon");

    displayWeapon(computerChoice, computerIcon);
}

/**
 * Compare user and computer's weapons and select winner
 */
function compareWeapons() {
    let userWeapon = document.getElementById("user-icon").getAttribute("class").split("-")[2];
    let computerWeapon = document.getElementById("computer-icon").getAttribute("class").split("-")[2];

    //Same weapom selected
    if (userWeapon === computerWeapon) {
        document.getElementById("result").textContent = "It's a draw!";
    }

    //Rock chosen by the user
    else if (userWeapon === "rock" && computerWeapon === "paper") {
        document.getElementById("result").textContent = "Paper covers rock, you lose :(";
        increaseComputerScore();
    } else if (userWeapon === "rock" && computerWeapon === "scissors") {
        document.getElementById("result").textContent = "Rock crushes scissors, you win!";
        increaseUserScore();
    } else if (userWeapon === "rock" && computerWeapon === "lizard") {
        document.getElementById("result").textContent = "Rock crushes lizard, you win!";
        increaseUserScore();
    } else if (userWeapon === "rock" && computerWeapon === "spock") {
        document.getElementById("result").textContent = "Spock vaporizes rock, you lose :(";
        increaseComputerScore();
    }

    //Paper chosen by the user
    else if (userWeapon === "paper" && computerWeapon === "rock") {
        document.getElementById("result").textContent = "Paper covers rock, you win!";
        increaseUserScore();
    } else if (userWeapon === "paper" && computerWeapon === "scissors") {
        document.getElementById("result").textContent = "Scissors cuts paper, you lose :(";
        increaseComputerScore();
    } else if (userWeapon === "paper" && computerWeapon === "lizard") {
        document.getElementById("result").textContent = "Lizard eats paper, you lose :(";
        increaseComputerScore();
    } else if (userWeapon === "paper" && computerWeapon === "spock") {
        document.getElementById("result").textContent = "Paper disproves Spock, you win!";
        increaseUserScore();
    }

    //Scissors chosen by the user
    else if (userWeapon === "scissors" && computerWeapon === "rock") {
        document.getElementById("result").textContent = "Rock crushes scissors, you lose :(";
        increaseComputerScore();
    } else if (userWeapon === "scissors" && computerWeapon === "paper") {
        document.getElementById("result").textContent = "Scissors cuts paper, you win!";
        increaseUserScore();
    } else if (userWeapon === "scissors" && computerWeapon === "lizard") {
        document.getElementById("result").textContent = "Scissors decapitates lizard, you win!";
        increaseUserScore();
    } else if (userWeapon === "scissors" && computerWeapon === "spock") {
        document.getElementById("result").textContent = "Spock smashes scissors, you lose :(";
        increaseComputerScore();
    }

    //Lizard chosen by the user
    else if (userWeapon === "lizard" && computerWeapon === "rock") {
        document.getElementById("result").textContent = "Rock crushes lizard, you lose :(";
        increaseComputerScore();
    } else if (userWeapon === "lizard" && computerWeapon === "paper") {
        document.getElementById("result").textContent = "Lizard eats paper, you win!";
        increaseUserScore();
    } else if (userWeapon === "lizard" && computerWeapon === "scissors") {
        document.getElementById("result").textContent = "Scissors decapitates lizard, you lose :(";
        increaseComputerScore();
    } else if (userWeapon === "lizard" && computerWeapon === "spock") {
        document.getElementById("result").textContent = "Lizard poisons Spock, you win!";
        increaseUserScore();
    }

    //Spock chosen by the user
    else if (userWeapon === "spock" && computerWeapon === "rock") {
        document.getElementById("result").textContent = "Spock vaporizes rock, you win!";
        increaseUserScore();
    } else if (userWeapon === "spock" && computerWeapon === "paper") {
        document.getElementById("result").textContent = "Paper disproves Spock, you lose :(";
        increaseComputerScore();
    } else if (userWeapon === "spock" && computerWeapon === "scissors") {
        document.getElementById("result").textContent = "Spock smashes scissor, you win!";
        increaseUserScore();
    } else if (userWeapon === "spock" && computerWeapon === "lizard") {
        document.getElementById("result").textContent = "Lizard poisons Spock, you lose :(";
        increaseComputerScore();
    }
}

/**
 * Get current user score from the DOM and increment it by 1
 */
function increaseUserScore() {
    let oldScore = parseInt(document.getElementById("user-score").textContent);
    document.getElementById("user-score").textContent = ++oldScore;
}

/**
 * Get current computer score from the DOM and increment it by 1
 */
function increaseComputerScore() {
    let oldScore = parseInt(document.getElementById("computer-score").textContent);
    document.getElementById("computer-score").textContent = ++oldScore;
}

/**
 * Keep track on the number of rounds and display game result at the end
 */
function countRounds() {
    let userScore = parseInt(document.getElementById("user-score").textContent);
    let computerScore = parseInt(document.getElementById("computer-score").textContent);

    if (userScore >= 3 || computerScore >= 3) {
        if (userScore > computerScore) {
            document.getElementById("result").textContent = `You win ${userScore}-${computerScore}!`;
            return true;
        } else if (userScore < computerScore) {
            document.getElementById("result").textContent = `You lose ${userScore}-${computerScore} :(`;
            return true;
        }
    } else {
        return false;
    }
}

function clearScore() {
    document.getElementById("user-score").textContent = 0;
    document.getElementById("computer-score").textContent = 0;
}

//Popups functions

/**
 * Open the pop up when pressing the respective button
 */
function openPopup(button) {
    if (button === "open-feedback-btn") {
        document.getElementById("feedback-form").style.display = "block";
    } else if (button === "open-rules-btn") {
        document.getElementById("rules").style.display = "block";
    } else {
        alert(`Unknown button: ${button}`);
        throw `Unknown butoon: ${button}. Aborting!`
    }
}

/**
 * Close the pop up if close button is pressed
 */
function closePopup(button) {
    if (button === "close-feedback-btn") {
        document.getElementById("feedback-form").style.display = "none";
    } else if (button === "close-rules-btn") {
        document.getElementById("rules").style.display = "none";
    } else {
        alert(`Unknown button: ${button}`);
        throw `Unknown button: ${button}. Aborting!`
    }
}